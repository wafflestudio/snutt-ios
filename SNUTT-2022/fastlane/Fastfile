# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

BUNDLE_IDENTIFIER = ENV['BUNDLE_IDENTIFIER']
BUILD_CONFIGURATION = ENV['BUILD_CONFIGURATION']
APP_STORE_CONNECT_KEY_ID = ENV['APP_STORE_CONNECT_KEY_ID']
APP_STORE_CONNECT_KEY_ISSUER = ENV['APP_STORE_CONNECT_KEY_ISSUER']
KEY_CONTENT = ENV['APP_STORE_CONNECT_KEY_CONTENT']

platform :ios do
  desc "üß™ Upload app to Testflight"
  lane :beta do
    certificates_distribution
    build_app(scheme: "SNUTT", 
              configuration: BUILD_CONFIGURATION,
              output_directory: "./archive",
              silent: true,
              clean: true)
    app_store_connect_api_key(
      key_id: APP_STORE_CONNECT_KEY_ID,
      issuer_id: APP_STORE_CONNECT_KEY_ISSUER,
      key_content: KEY_CONTENT,
    )
    upload_to_testflight
  end

  desc "üîê Configure certificates and provisioning profiles for development"
  lane :certificates_development do
    match(type: "development", app_identifier: [BUNDLE_IDENTIFIER, "#{BUNDLE_IDENTIFIER}.widget"], readonly: true)
  end

  desc "üîê Configure certificates and provisioning profiles for distribution"
  lane :certificates_distribution do
    match(type: "appstore", app_identifier: [BUNDLE_IDENTIFIER, "#{ENV['BUNDLE_IDENTIFIER']}.widget"], readonly: true)
  end

end
